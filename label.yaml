version: "3"

services:
  # download transactions from s3
  get-addresses:
    build: ./make-txr-addr
    volumes:
      - $DATA_DIR/txs/:/data
    environment:
      AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID
      AWS_SECRET_ACCESS_KEY: $AWS_SECRET_ACCESS_KEY
      AWS_REGION: $AWS_REGION_NAME
      AWS_BUCKET_NAME: $AWS_BUCKET_NAME
      AWS_FILE_PREFIX: $AWS_FILE_PREFIX
      UPLOADING_HOST: 0259bbd85af5
      LOCAL_DATA_DIR: /data
      FILE_PATTERN: "*.log.gz"
      ADDRESS_FILE: addr.txt.gz
      TRANSACTION_FILE: transactions.txt.gz
      COUNT_FILE: addr-cnts.txt.gz
    command:
      - "/bin/bash"
      - "-c"
      - "copy-txcs.sh && get-addrs.sh && cnt-addrs.sh && get-transactions.sh"
